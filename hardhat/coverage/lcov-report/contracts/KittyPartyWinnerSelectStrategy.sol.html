<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/KittyPartyWinnerSelectStrategy.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> KittyPartyWinnerSelectStrategy.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/19</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: BSL
pragma solidity ^0.8.0;
&nbsp;
import "@chainlink/contracts/src/v0.8/VRFConsumerBase.sol";
&nbsp;
import "./base/KittyPartyWinnerSelectionOptions.sol";
import "hardhat/console.sol";
contract KittyPartyWinnerSelectStrategy is  KittyPartyWinnerSelectionOptions {
    uint256 public randomness;
    uint256 internal fee;
    uint256 numberOfKittens;
&nbsp;
    uint256[] public winnerIndexes;
    uint256[] public prevWinnerIndexes;
    address kittens;
    
    bytes32 internal keyHash;
&nbsp;
    bytes32 constant NULL = "";
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor(uint8 _winnerStrategy, bool _vrfEnabled) </span>
      // VRFConsumerBase(
      //     0x8C7382F9D8f56b33781fE506E897a4F1e2d17255, // VRF Coordinator
      //     0x326C977E6efc84E512bB9C30f76E30c160eD06FB // LINK Token
      // )
      KittyPartyWinnerSelectionOptions(_winnerStrategy, _vrfEnabled)
    {
<span class="cstat-no" title="statement not covered" >        keyHash = 0x2ed0feb3e7fd2022120aa84fab1945545a9f2ffc9076fd6156fa96eaff4c1311</span>;
<span class="cstat-no" title="statement not covered" >        fee = 0.1 * 10**18</span>; 
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function initiateCheckWinner(uint _numberOfKittens) external {</span>
      //clear previous winners
      delete winnerIndexes;
      //check strategy call relevant functions based on strategy call
      //Also implement a better strategy for a random user provided seed
<span class="cstat-no" title="statement not covered" >      numberOfKittens = _numberOfKittens</span>;
<span class="cstat-no" title="statement not covered" >      if (winnerStrategy == WinningStrategy.DistributeEqual) {</span>
<span class="cstat-no" title="statement not covered" >          for (uint i = 0; i &lt; numberOfKittens; i++) {</span>
<span class="cstat-no" title="statement not covered" >              winnerIndexes.push(i)</span>;
          }
      } else <span class="cstat-no" title="statement not covered" >if (winnerStrategy == WinningStrategy.Bid) {</span>
        //check the lowest bid value and call setWinner
      } else{ 
<span class="cstat-no" title="statement not covered" >        runLottery()</span>;
      }
    }
        
<span class="fstat-no" title="function not covered" >    function runLottery()</span>
        private
        returns (bytes32 requestId)
    {
<span class="cstat-no" title="statement not covered" >        if (vrfEnabled == false) {</span>
<span class="cstat-no" title="statement not covered" >          fulfillRandomness(NULL, uint256(keccak256(abi.encode(block.timestamp + block.difficulty))))</span>;
<span class="cstat-no" title="statement not covered" >          return NULL;</span>
        } else {
          // require(
          //     LINK.balanceOf(address(this)) &gt;= fee,
          //     "Not enough LINK - fill contract with faucet"
          // );
          // return requestRandomness(keyHash, fee);
        }
    }
&nbsp;
    /**
    * Callback function used by VRF Coordinator
    */
<span class="fstat-no" title="function not covered" >    function fulfillRandomness(bytes32, uint256 _randomness)</span>
        internal
        // override
    {
<span class="cstat-no" title="statement not covered" >        randomness = _randomness</span>;
        //do a callback to msg.sender
<span class="cstat-no" title="statement not covered" >        setLotteryWinner()</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setLotteryWinner() private {</span>
<span class="cstat-no" title="statement not covered" >      if (winnerStrategy == WinningStrategy.SingleLosslessLotteryWinnerPerRound) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 randomResult = (randomness % numberOfKittens) + 1;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        winnerIndexes[0] = randomResult</span>;
        // winnerAddresses.push(Kittens(kittens).getValueAt(randomResult));
      } else { 
        //use randomness to choose 3 individual winners
      }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getWinners() external view returns (uint256[] memory) {</span>
<span class="cstat-no" title="statement not covered" >        return winnerIndexes;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getWinnerAtLocation(uint i) external view returns (uint256){</span>
<span class="cstat-no" title="statement not covered" >        return winnerIndexes[i];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getLength() external view returns (uint) {</span>
<span class="cstat-no" title="statement not covered" >        return winnerIndexes.length;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Sep 20 2021 19:11:10 GMT+0800 (Singapore Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
